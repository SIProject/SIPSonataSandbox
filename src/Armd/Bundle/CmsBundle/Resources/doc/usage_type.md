# Типы использования и группы
## Типы использования
"Типы использования" (UsageType) предназначены, чтобы указать, какой NameBundle::Controller:Action будет обработан в текущей области страницы.
Является ключевым связующим звеном между контроллером модуля и конечной страницей.

При этом "тип использования" может содержать информацию о части uri, связанную с передачей get-параметров контроллеру, а также предустановленные (через административный интерфейс) дополнительные настройки.

Каждый публикуемый на сайте модуль может иметь несколько типов использования, указывающих на различные контроллеры.

### Пример
Для модуля новости можно выделить след. "типы использования":
* список новостей
* отображение новости

Тип использования "список новостей" будет содержать дополнительную настройку "кол-во новостей на страницу"
Тип использования "отображение новости" обязательный get-параметр "id".

## Группы контейнеров использования
Для удобства разработки и использования, "типы использования" объединены в группы (UsageTypeContainer).

Группа может содержать в себе несколько различных типов использования, при этом:
* для контейнера страницы помеченной как "главный" будет обработан, первый "тип использования", для которого будет найдено совпадение get-параметра
* для остальные контейнеров будет обработан 1й контейнер не содержащий параметров запроса

## Код
Для того, что бы внедрить "типы использования" необходимо определить сервис armd_<bundlename>.usagetype и пометить его тэгом name: armd_cms.usage
В качестве аргументов сервиса выступят:
* уникальное корневое имя бандла (для модуля новостей, это будет "armd_news")
* массив параметров, определяющих конфигурацию UsageTypeContainer

Пример такого внедрения:
    parameters:
        armd_news.usagetypes:
            types:
                item:
                    controller: news
                    action: show
                    title: Карточка новости
                    route:
                        pattern: /{id}
                        requirements:
                            id: \d+
                list:
                    controller: news
                    action: index
                    title: Список новостей
                    params:
                        per_page:
                            title: Новостей на страницу
                            default: 10
                            type: int
                            requirements: 1
            group:
                item:
                    types: [item]
                list:
                    types: [list]
                listitem:
                    types: [item, list]

    services:
        armd_news.usagetype:
            class: %armd_cms.usagetype.class%
            arguments: ["armd_news", %armd_news.usagetypes%]
            tags:
                -  { name: armd_cms.usage }

## Параметры сервиса подробнее.
Глобальный массив параметров должен содержать 2 ключа:
* types
* group

В types хранится объявление именованных "типов использования", в формате
    item:                                       # уникальное имя типа использования
        controller: news                        # контроллер, в который будет передан запрос
        action: show                            # action контроллера, в который будет передан запрос
        title: Карточка новости                 # название типа использования
        route:                                  # описание ожидаемых get параметров, если не указан, учитывается как "/"
            pattern: /{id}                      #
            requirements:                       # подробнее см. http://symfony.com/doc/current/book/routing.html
                id: \d+                         #
    list:
        ...
        params:                                 # дополнитель параметры (будут настраиваться в админке, опциональное)
            per_page:                           # системеное имя параметра (произвольная строка)
                title: Новостей на страницу     # название параметра (будет показано админке)
                default: 10                     # значение параметра по умолчанию
                type: int                       # тип параметра (подробнее см. CmsBundle/UsageType/Param/* )
                requirements: 1                 # обязательность параметра, для указания в админке


В group хранятся указатели на используемые "типы использования". В конечном счете именно group формирует отображаемые в админке настройки для блока.