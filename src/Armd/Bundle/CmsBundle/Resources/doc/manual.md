# Руководство для верстальщика и контент менеджера.
CMS создана на основе фреймворка Symfony2, который в свою очередь использует
шаблонизатор twig (http://twig.kron0s.com/ http://twig.sensiolabs.org/).

# Админка

На главной странице админки выведен список модулей, которые были добавлены в избранное для быстрого доступа.
Навигация по сайту осуществляется с помощью верхнего меню.

# Модули

В этой вкладке выводится список доступных модулей, в которые можно добавляться контент. Небольшая
хитрость состоит с текстовым модулем. Чтобы вывести текст на сайт, мы должны сначала его сначала добавить,
а потом уже в том блоке, где он должен показываться выбрать его. Для этого используется поле «индификатор»
в Параметрах блока.
Для всех модулей мы можем добавлять контент, с помощью кнопки «Добавить новый» или просматривать уже
имеющийся, с помощью кнопки «Список».
Отдельного рассмотрения заслуживает модуль «Элементы меню». Меню можно создавать двумя способами.
1. Заходим на страницу «Модули», находим модуль «Элементы меню», жмем на кнопку «Добавить новый».
Открывается страница, где указываем заголовок меню, название меню (обязательно должно быть заполнено
для родительского меню, иначе меню не будет отображаться), url или ссылка на уже созданный раздел,
в самом конце указывается родительский элемент меню или оставляется пустым, если хотим чтобы данный
пункт сам стал родительским.
2. Более простой вариант. Заходим на страницу «Структуру», нажимаем на кнопку «Список», расположенную
напротив пункта «Разделы», и нажимаем на кнопку «Меню». Чтобы создать меню, в правой части экрана,
пишем название меню и нажимаем кнопку создать. Если структура нашего сайта совпадает со элементами меню,
то мы можем переносить из левой части название разделов в правую часть, и элементы меню будут создаваться
автоматически.

# Структура
1. Раздел.
    Раздел является основной структурной единицей сайта. При создании нового раздела указываются: заголовок,
    псевдоним, родительский элемент и тип представления (Тип страниц). Все поля кроме родительского элемента
    являются обязательным для заполнения. Если поле «родительский элемент» оставить пустым, то новый раздел
    будет родительским. При наведении на уже существующий раздел появляется меню, в котором можно редактировать,
    копировать, удалять, создавать новые разделы.

2. Типы страниц.
    Тип страницы содержит в себе набор контейнеров. При создании нового типа, нужно выбрать
    к какому шаблону будет применяться этот тип.

    a. Шаблон раздела.
        Шаблон раздела является совокупностью файлов, содержащих в себе постоянную часть HTML-кода страниц,
        т.е. содержит верстку тех участков, в которые не помещены модули. К сожалению, на данный момент
        создать шаблон раздела из админки нельзя. Чтобы создать новый шаблон раздела, нам нужно открыть файл
        template.yml в файловой системе проекта(vendor\bundles\Armd\Bundle\MkResourcesBundle\Resources\config\template.yml)
        и в разделе layout: после последнего шаблона добавить новый по аналогии. После этого создать папку
        в vendor\bundles\Armd\Bundle\MkResourcesBundle\Resources\views\layout\ c названием шаблона раздела.
        В папке создать файл с названием index.html.twig и blocks.html.twig. В файле index.html.twig содержится
        верстка со вставленными на свои места контейнерами. В файле blocks.html.twig содержится описания
        контейнеров, и их сетка, которую можно увидеть в админке. Перед тем, как создавать контейнеры
        в админке, лучше описать их в файле blocks.html.twig.

    b. Контейнер.
        Контейнер  - сущность в БД, которая связанна с типом страницы и непосредственно контентным модулем. С помощью контейнеров можно выводить контент на фронтэнде.
        Чтобы создать новый контейнер для определенного типа страницы, нужно сначала описать название контейнеров в файле blocks.html.twig. После этого зайти на страницу типов страниц и нажать на кнопку «Добавить контейнер».
        При создании нового контейнера обязательно заполняются поля «Название» и «Тип представления». Поле «Название» используется в дальнейшем для вставки в файл шаблона. Например, если мы название контейнер «index_search», то в файл шаблона мы вставляем следующую конструкцию: {{ getContainerContent('index_search')|raw }}, где raw – отключение экранирования тэгов HTML.
        В дальнейшем в «контейнер» мы можем помещать любые созданные блоки. Если мы хотим чтобы контейнер уже
        содержал блоки по умолчанию, то при создании контейнера нужно выбрать модуль и представления модуля.
        После выбора представления модуля появляется возможность указать параметры модуля. У каждого модуля
        могут быть свои параметры. Например, у модуля «текст» выбираться шаблон и индификатор(контент, который
        мы добавили в модуль. Если Вы хотите, чтоб данный контейнер был главной областью – поставьте галочку.  Главная область, это область на которую ссылаются блоки с разных частей сайта.


    c. Блок.
        Блок - это сущность, которая связанна с контейнером, страницей, и контентным модулем.
        Блок нужен для переопределения настроек контейнера для определенного типа страницы.

# Файловая система
Все шаблоны, файловые ресурсы хранятся в бандле.
Путь: vendor\bundles\Armd\Bundle\Название Вашего бандла\Resources
В папке Resources состоит из трех папок:
	config – настройки для шаблона. В частности интересует файл template.yml,
	в котором мы прописываем названия, параметры, свойства вновь созданных шаблонов раздела и шаблонов
	модуля. В этом файле обязательно нужно учитывать количество пробелов. Желательно настроить свой редактор,
	чтобы знаки табуляции были заменены на пробел.

Пример файла template.yml:
parameters:
    armd_cms.theme.mk:
            name: ArmdMkResourcesBundle
            title: Министерство Культуры
            layout:
                main: - так же должна и называться папка в которой хранятся файлы шаблона раздела
                    default: false
                    title: Шаблон по умолчанию – это название будет доступно из админки
                index:
                    default: false
                    title: Шаблон главной страницы
module:
                ArmdTextBundle: - так должна называться папка модуля, в которой хранятся шаблоны для модуля
                    template:
                        default: - так называется папка одного шаблона.
                            title: Основной шаблон
                        static-html: - так называется папка одного шаблона.
                            title: Шаблон для HTML
                ArmdExtendedNewsBundle: - так должна называться папка модуля, в которой хранятся шаблоны для модуля
                    template:
                        default: - так называется папка одного шаблона.
                            title: Основной шаблон

public – в папке хранятся  css, js, img.
	views – хранятся сами шаблоны.
	Папка views имеет две вложенные папки и один корневой файл.
	layout – в этой папке лежат шаблоны раздела. Шаблоны раздела лежат в отдельных папках,
	которые должны иметь одинаковые названия с названиями, которые были прописаны в template.yml
	при описании шаблонов раздела.
    В папке с шаблоном лежат два файла: blocks.html.twig и index.html.twig
        index.html.twig – отвечает за разметку нашего типа страницы
        blocks.html.twig – описывает контейнеры, которые используются в типе страницы.
	module – в этой папке лежат шаблоны модуля. Шаблоны модулей лежат в отдельных папках,
	которые должны иметь одинаковые названия с названиями, которые были прописаны в template.yml
	при описании шаблонов модулей. Внутри этих папок лежат файлы, которые отвечают за вариант
	представления модуля. Варианты представления модуля выбираются из админки в параметрах модуля.
layout.mk.html.twig – это родительский файл, в котором заданы doctype, <header> <body>
Можно создать другой файл и из своих шаблонов разделов наследовать их.
Пути к ресурсам (css, js, img) указываются через assets Twig function.
Путь до css, js можно добавить напрямую в  layout.mk.html.twig (или вновь созданный лайаут) или же
добавлять в шаблон раздела. В этом случае будет использоваться обратное наследование.

# Инструкция по созданию шаблонов модулей и разделов.
	Чтобы создать новый шаблон раздела или модуля, нужно в файле template.yml прописать 	соответствующие свойства.
Шаблон раздела создается под словом «layout:», шаблон модуля создается под словом «module» и с названием нужного модуля.
Пример:
ArmdEventBundle:
                    template:
                        default:
                            title: Основной шаблон
где, ArmdEventBundle – название модуля, template – означает что мы описываем шаблон для модуля, default: - название шаблона, title – заголовок, который будет выводиться в админке.
Файловая структура модуля, должна соответствовать этим параметрам:
\ ArmdEventBundle \default\list.event.html.twig


ПРИМЕР:
Представим, что у нас кроме шаблона раздела для главной страницы нет других шаблонов. Как мы знаем, шаблон раздела это наш каркас для расположения блоков.
1. Создаем новый шаблон раздела в файле template.yml
    a. layout:
                    index: - название папки шаблона раздела
                        default: false
                        title: Шаблон главной страницы
    Создаем в файловой системе \MkResourcesBundle\Resources\views\layout папку index, создаем там файлик index.html.twig. В этот файл вставляем верстку, которая не относится к модулям. На место расположения модуля вставляем следующую конструкцию: {{ getContainerContent('index_search')|raw }}, где index_search название контенера. Шапка наследуется из файла layout.mk.html.twig. Если нужно поменять doctype, или прописать свои настройки, то можно создать еще один файл, и наследовать из него.
    В файле blocks.html.twig нужно описать контейнеры, которые мы создадим через админку для определенного типа страницы. Этот файл определяют сетку блоков в админке. Заполняем этот файл уже после того, как создали контейнеры для типа страницы.
    Файл blocks.html.twig имеет следующий вид:

    {% macro getSettings(containers) %}
        {% import 'ArmdCmsBundle:macro:table.html.twig' as table %}
        {% import 'ArmdCmsBundle:macro:common.html.twig' as common %}
        {% import 'ArmdCmsBundle:macro:tabs.html.twig' as tabs %}

        {# test_top #}
        {% set test_top %}
            {{ table.create({'title': 'test_top', 'colspan': 3}, containers) }}
        {% endset %}

        {# test_left #}
        {% set test_left %}
            {{ table.create({'title': 'test_left', 'colspan': 3}, containers) }}
        {% endset %}

        {# content #}
        {% set content %}
            {{ table.create({'title': 'content', 'colspan': 3}, containers) }}
        {% endset %}

        {# content_footer #}
        {% set content_footer %}
            {{ table.create({'title': 'content_footer', 'colspan': 3}, containers) }}
        {% endset %}
    <!—Ниже формируется сетка контейнеров, которая будет видна в админке -->
        <div class="tab-content-blocks">
        {{ common.block(test_top, {'class': 'block-half'}) }}
            {{ common.block(test_left, {'class': 'block-half'}) }}
            {{ common.block(content, {'class': 'block-full'}) }}
            {{ common.block(content_footer, {'class': 'block-full'}) }}
        </div>
    {% endmacro %}
    Параметры
    'block-half' – контейнер будет занимать две ячейки
    'block-full' – контейнер будет занимать три ячейку
    'block-third' – контейнер будет занимать одну ячейку.
2. После того как у нас создан шаблон, нужно создать для него тип страницы.
   Заходим в админку на страницу типов страниц, нажимаем на «Создать новый», пишем названием, и выбираем
   шаблон раздела для которого будет приниматься этот тип шаблона. У типа шаблона может быть несколько
   шаблонов, но использоваться может только один.
3. Затем нам нужно создать раздел, нашу страницу, на которой и будет выводиться наши модули или контент.
   Заходим в пункт «раздел», добавляем. Указываем тип страницы, который был создан пункте 2.
4. Если мы хотим на странице выводить новости или текстовые блоки, то добавляем их в админке.
5. Теперь осталось создать нашему типу страницы контейнеры, которые будут в нем использоваться.
   Если на нашей страницы должно выводиться меню, текстовый блок и новости, то нам нужно создать три
   контейнера. Создаем новый контейнер, в котором и выбираем нужный нам типа страницы. Если мы точно
   уверенны, что этот контейнер будет использоваться только с определенным модулем и видом представления,
   то задаем эти параметры здесь. Если нам нужно в другом разделе вместо меню выводить на том же самом
   месте список последних новостей, мы можем не создавать новый контейнер для другого раздела, который в
   свою очередь использует тот же типа страницы, а переопределить наш контейнер через блок. Т.е. для разных
   разделов  контейнер может содержать разные модули.  Переопределять можно через кнопку «Изменить»
   находясь непосредственно в настройках раздела. Не забываем вставить имя контейнера в файл шаблона в то
   место, где должен выводиться модуль или контент и заполнить файл blocks.html.twig
   Если нам нужен новый шаблон для модулей, то правим файлик template.yml.
6. Если нам нужно переопределить наш контейнер, то мы это делаем через блоки. Переопределять блоки можно
   только внутри типа страницы. Для каждого типа страниц нужно создавать свои контейнеры.
7. Чтобы попасть на нашу страницу, нам нужно меню. Создаем новое меню, выбираем ранее созданный раздел.
8. Проверяем что получилось.